import{_ as L,r as i,g as E,h as B,c as v,a as m,b as a,w as r,d as n,e as j,o as p,i as N,j as O,f as V,E as b}from"./index-CVtVCzsP.js";import{r as h}from"./request-CSTMYV-j.js";const D={class:"register-root"},T=["src"],A={key:1,class:"avatar-placeholder"},M={__name:"Register",setup(P){const g=j(),l=i({username:"",email:"",studentId:"",password:"",confirm:"",role:"user",inviteCode:""}),_=i(null),f=i(null),d=i(""),y={username:[{required:!0,message:"请输入用户名",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"邮箱格式不正确",trigger:"blur"}],studentId:[{required:!0,message:"请输入学号",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}],confirm:[{required:!0,message:"请确认密码",trigger:"blur"},{validator:(u,e,t)=>{e!==l.value.password?t(new Error("两次输入密码不一致")):t()},trigger:"blur"}],role:[{required:!0,message:"请选择角色",trigger:"change"}],inviteCode:[{validator:(u,e,t)=>{l.value.role==="admin"?e?e!=="123qwe"?t(new Error("邀请码不正确")):t():t(new Error("请输入管理员邀请码")):t()},trigger:"blur"}]},C=()=>{_.value.validate(async u=>{var e,t;if(u)try{const o=new FormData;o.append("username",l.value.username),o.append("email",l.value.email),o.append("studentId",l.value.studentId),o.append("password",l.value.password),o.append("role",l.value.role),l.value.role==="admin"&&o.append("inviteCode",l.value.inviteCode),f.value&&o.append("avatar",f.value),await h.post("/auth/register",o,{headers:{"Content-Type":"multipart/form-data"}}),b.success("注册成功，请登录"),g.push("/login")}catch(o){b.error(((t=(e=o.response)==null?void 0:e.data)==null?void 0:t.error)||"注册失败")}})},U=()=>g.push("/login"),R=u=>{u!=null&&u.raw&&(d.value&&URL.revokeObjectURL(d.value),f.value=u.raw,d.value=URL.createObjectURL(u.raw))};return E(()=>l.value.role,u=>{u!=="admin"&&(l.value.inviteCode="")}),B(()=>{d.value&&URL.revokeObjectURL(d.value)}),(u,e)=>{const t=n("el-input"),o=n("el-form-item"),c=n("el-option"),q=n("el-select"),I=n("el-upload"),w=n("el-button"),k=n("el-form"),x=n("el-card");return p(),v("div",D,[e[11]||(e[11]=m("div",{class:"bg-overlay"},null,-1)),a(x,{class:"register-card"},{default:r(()=>[e[10]||(e[10]=m("h2",{class:"register-title"},"注册新账号",-1)),a(k,{model:l.value,rules:y,ref_key:"formRef",ref:_,"label-width":"90px"},{default:r(()=>[a(o,{label:"用户名",prop:"username"},{default:r(()=>[a(t,{modelValue:l.value.username,"onUpdate:modelValue":e[0]||(e[0]=s=>l.value.username=s),autocomplete:"off"},null,8,["modelValue"])]),_:1}),a(o,{label:"邮箱",prop:"email"},{default:r(()=>[a(t,{modelValue:l.value.email,"onUpdate:modelValue":e[1]||(e[1]=s=>l.value.email=s),autocomplete:"off",placeholder:"请输入常用邮箱"},null,8,["modelValue"])]),_:1}),a(o,{label:"学号",prop:"studentId"},{default:r(()=>[a(t,{modelValue:l.value.studentId,"onUpdate:modelValue":e[2]||(e[2]=s=>l.value.studentId=s),autocomplete:"off",placeholder:"请输入学号"},null,8,["modelValue"])]),_:1}),a(o,{label:"密码",prop:"password"},{default:r(()=>[a(t,{modelValue:l.value.password,"onUpdate:modelValue":e[3]||(e[3]=s=>l.value.password=s),type:"password",autocomplete:"off"},null,8,["modelValue"])]),_:1}),a(o,{label:"确认密码",prop:"confirm"},{default:r(()=>[a(t,{modelValue:l.value.confirm,"onUpdate:modelValue":e[4]||(e[4]=s=>l.value.confirm=s),type:"password",autocomplete:"off"},null,8,["modelValue"])]),_:1}),a(o,{label:"角色",prop:"role"},{default:r(()=>[a(q,{modelValue:l.value.role,"onUpdate:modelValue":e[5]||(e[5]=s=>l.value.role=s),placeholder:"请选择角色",style:{width:"100%"}},{default:r(()=>[a(c,{label:"普通用户",value:"user"}),a(c,{label:"管理员",value:"admin"})]),_:1},8,["modelValue"])]),_:1}),l.value.role==="admin"?(p(),N(o,{key:0,label:"邀请码",prop:"inviteCode"},{default:r(()=>[a(t,{modelValue:l.value.inviteCode,"onUpdate:modelValue":e[6]||(e[6]=s=>l.value.inviteCode=s),autocomplete:"off",placeholder:"请输入管理员邀请码",type:"password","show-password":""},null,8,["modelValue"])]),_:1})):O("",!0),a(o,{label:"头像(可选)"},{default:r(()=>[a(I,{class:"avatar-uploader",action:"#","show-file-list":!1,"auto-upload":!1,accept:"image/*",onChange:R},{default:r(()=>[d.value?(p(),v("img",{key:0,src:d.value,class:"avatar-preview"},null,8,T)):(p(),v("div",A,e[7]||(e[7]=[m("i",{class:"el-icon-plus"},null,-1),m("span",null,"上传头像",-1)])))]),_:1})]),_:1}),a(o,null,{default:r(()=>[a(w,{type:"primary",onClick:C},{default:r(()=>e[8]||(e[8]=[V("注册")])),_:1,__:[8]}),a(w,{type:"text",onClick:U},{default:r(()=>e[9]||(e[9]=[V("返回登录")])),_:1,__:[9]})]),_:1})]),_:1},8,["model"])]),_:1,__:[10]})])}}},H=L(M,[["__scopeId","data-v-e5037a06"]]);export{H as default};
