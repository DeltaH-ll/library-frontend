import{_ as x,u as E,r as g,c as C,a as u,b as l,w as n,d,e as R,o as h,f as v,E as t}from"./index-CVtVCzsP.js";import{r as I}from"./request-CSTMYV-j.js";const N={class:"login-root"},q={class:"extra-action"},B={__name:"Login",setup(L){const f=R(),w=E(),i=g({identifier:"",password:""}),m=g(null),p=g(!1),b={identifier:[{required:!0,message:"è¯·è¾“å…¥è´¦å·",trigger:"blur"}],password:[{required:!0,message:"è¯·è¾“å…¥å¯†ç ",trigger:"blur"}]},k=async()=>{var c,e;if(!m.value){t.error("è¡¨å•æœªåˆå§‹åŒ–ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•");return}try{await m.value.validate(),p.value=!0;const o=(await I.post("/auth/login",i.value)).data||{};if(!o.success){t.error("ç™»å½•å¤±è´¥ï¼š"+(o.msg||"ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯"));return}if(!o.user){console.error("ç™»å½•å“åº”ç¼ºå°‘ç”¨æˆ·ä¿¡æ¯",o),t.error("ç™»å½•å¤±è´¥ï¼šæœåŠ¡å™¨æœªè¿”å›žç”¨æˆ·ä¿¡æ¯");return}if(!o.token){console.error("ç™»å½•å“åº”ç¼ºå°‘ token",o),t.error("ç™»å½•å¤±è´¥ï¼šæœåŠ¡å™¨æœªè¿”å›žè®¤è¯ä»¤ç‰Œï¼Œè¯·è”ç³»ç®¡ç†å‘˜");return}const r=o.user,a=[];if(r.id||a.push("ç”¨æˆ·ID"),r.username||a.push("ç”¨æˆ·å"),r.role||a.push("ç”¨æˆ·è§’è‰²"),a.length>0){console.error("ç”¨æˆ·ä¿¡æ¯ä¸å®Œæ•´",r),t.error(`ç™»å½•å¤±è´¥ï¼šç”¨æˆ·ä¿¡æ¯ç¼ºå°‘${a.join("ã€")}`);return}w.login({username:r.username,role:r.role,id:r.id,token:o.token,email:r.email,studentId:r.studentId,avatar:r.avatar}),t.success(`æ¬¢è¿Žå›žæ¥ï¼Œ${r.username}`),r.role==="admin"?f.push("/admin/dashboard"):f.push("/user/my-borrow")}catch(s){s.isAxiosError?(console.error("ç™»å½•è¯·æ±‚é”™è¯¯ï¼š",s),s.message.includes("Network Error")?t.error("ç½‘ç»œé”™è¯¯ï¼Œè¯·æ£€æŸ¥åŽç«¯æ˜¯å¦å¯åŠ¨æˆ–åœ°å€æ˜¯å¦æ­£ç¡®"):((c=s.response)==null?void 0:c.status)===403?t.error("è·¨åŸŸæƒé™è¢«æ‹’ç»ï¼Œè¯·æ£€æŸ¥åŽç«¯CORSé…ç½®"):t.error(`è¯·æ±‚å¤±è´¥ï¼š${((e=s.response)==null?void 0:e.status)||"æœªçŸ¥é”™è¯¯"}`)):s.name!=="ValidationError"&&(console.error("ç™»å½•å¼‚å¸¸ï¼š",s),t.error("ç™»å½•å¤±è´¥ï¼Œè¯·é‡è¯•"))}finally{p.value=!1}},y=()=>f.push("/register");return(c,e)=>{const s=d("el-input"),o=d("el-form-item"),r=d("el-button"),a=d("el-form"),V=d("el-card");return h(),C("div",N,[e[6]||(e[6]=u("div",{class:"bg-overlay"},null,-1)),l(V,{class:"login-card"},{default:n(()=>[e[5]||(e[5]=u("div",{class:"welcome"},[u("p",{class:"welcome-title"},"æ¬¢è¿Žå›žæ¥ ðŸ‘‹"),u("p",{class:"welcome-desc"},"ä¸€å¥é—®å€™ï¼Œä¸€æ¬¡å€Ÿé˜…ï¼Œå¼€å¯ä»Šå¤©çš„é˜…è¯»ä¹‹æ—…")],-1)),l(a,{model:i.value,rules:b,ref_key:"formRef",ref:m,"label-width":"90px",class:"login-form"},{default:n(()=>[l(o,{label:"ç™»å½•è´¦å·",prop:"identifier"},{default:n(()=>[l(s,{modelValue:i.value.identifier,"onUpdate:modelValue":e[0]||(e[0]=_=>i.value.identifier=_),autocomplete:"off",placeholder:"è¯·è¾“å…¥ç”¨æˆ·å / é‚®ç®± / å­¦å·",clearable:""},null,8,["modelValue"])]),_:1}),l(o,{label:"ç™»å½•å¯†ç ",prop:"password"},{default:n(()=>[l(s,{modelValue:i.value.password,"onUpdate:modelValue":e[1]||(e[1]=_=>i.value.password=_),type:"password",autocomplete:"off",placeholder:"è¯·è¾“å…¥å¯†ç ","show-password":""},null,8,["modelValue"])]),_:1}),l(o,{class:"btn-row"},{default:n(()=>[l(r,{type:"primary",onClick:k,loading:p.value,round:"",block:""},{default:n(()=>e[2]||(e[2]=[v(" ç«‹å³ç™»å½• ")])),_:1,__:[2]},8,["loading"])]),_:1})]),_:1},8,["model"]),u("div",q,[e[4]||(e[4]=u("span",null,"è¿˜æ²¡æœ‰è´¦å·ï¼Ÿ",-1)),l(r,{type:"text",onClick:y},{default:n(()=>e[3]||(e[3]=[v("é©¬ä¸Šæ³¨å†Œ")])),_:1,__:[3]})])]),_:1,__:[5]})])}}},D=x(B,[["__scopeId","data-v-c900462f"]]);export{D as default};
