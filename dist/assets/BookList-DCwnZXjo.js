import{_ as P,u as R,r as c,l as G,c as v,a as l,b as s,q as H,s as J,d as _,v as O,i as Q,w as d,F as X,E as C,o as p,f as u,t as i,j as Y,x as Z}from"./index-CVtVCzsP.js";import{r as N,A as ee}from"./request-CSTMYV-j.js";const te={class:"books-root"},le={class:"books-header"},ae={class:"books-actions"},oe=["src"],ne={key:1,class:"no-cover"},se={style:{"line-height":"1.1"}},re={style:{color:"#999"}},ie={class:"pager",style:{display:"flex","justify-content":"flex-end","margin-top":"12px"}},ue={key:0,class:"detail-loading"},de={key:1,class:"detail-content"},ce=["src"],pe={class:"detail-info"},ve={key:2,class:"detail-empty"},_e={__name:"BookList",setup(ge){R();const B=c([]),f=c(""),y=c(!1),g=c(1),h=c(10),V=c(0),k=c(!1),w=c(!1),r=c(null),S=t=>{const e=Number(t);return Number.isFinite(e)?`Â¥${e.toFixed(2)}`:"Â¥0.00"},x=t=>{const e=Number(t.total_count),n=Number(t.available_count),a=Number.isFinite(e)?e:0,b=Number.isFinite(n)?n:0;return a<=0?"ä¸å¯å€Ÿé˜…":b>=a?"å…¨éƒ¨åœ¨é¦†":b<=0?"ä¸å¯å€Ÿé˜…":"éƒ¨åˆ†å€Ÿå‡º"},E=t=>{const e=x(t);return e==="å…¨éƒ¨åœ¨é¦†"?"success":e==="éƒ¨åˆ†å€Ÿå‡º"?"warning":"danger"},z=(t,e,n)=>{if(!n)return"â€”";const a=new Date(n);return isNaN(a)?n:a.toLocaleDateString()},D=t=>{if(!t)return"";if(t.startsWith("http://")||t.startsWith("https://"))return t;const e=ee.replace(/\/$/,""),n=t.startsWith("/")?t:`/${t}`;return e+n},m=async()=>{y.value=!0;try{const e=(await N.get("/books",{params:{page:g.value,limit:h.value,keyword:f.value||void 0}})).data||{};B.value=e.data||[],V.value=e.total||0}catch(t){console.error(t),C.error("åŠ è½½å›¾ä¹¦å¤±è´¥")}finally{y.value=!1}},$=async t=>{var e,n;try{await Z.confirm(`ç¡®å®šè¦å€Ÿé˜…ã€Š${t.title}ã€‹å—ï¼Ÿ`,"å€Ÿé˜…ç¡®è®¤",{type:"warning"}),await N.post("/borrow",{book_id:t.id}),C.success("å€Ÿé˜…æˆåŠŸ"),m()}catch(a){if(a!=="cancel"){const b=((n=(e=a==null?void 0:a.response)==null?void 0:e.data)==null?void 0:n.error)||"å€Ÿé˜…å¤±è´¥";C.error(b)}}},L=()=>{g.value=1,m()},U=()=>{g.value=1,f.value="",m()},A=t=>{g.value=t,m()},j=t=>{h.value=t,g.value=1,m()},M=async t=>{var e;k.value=!0,w.value=!0;try{const n=await N.get(`/books/${t.id}`);r.value=((e=n.data)==null?void 0:e.data)||t}catch(n){console.error("åŠ è½½å›¾ä¹¦è¯¦æƒ…å¤±è´¥:",n),r.value=t}finally{w.value=!1}};return G(m),(t,e)=>{const n=_("el-input"),a=_("el-table-column"),b=_("el-tag"),F=_("el-button"),T=_("el-table"),W=_("el-pagination"),q=_("el-drawer"),I=O("loading");return p(),v(X,null,[l("div",te,[l("div",le,[e[2]||(e[2]=l("h1",{class:"books-title"},"ğŸ“š å›¾ä¹¦åˆ—è¡¨",-1)),l("div",ae,[s(n,{modelValue:f.value,"onUpdate:modelValue":e[0]||(e[0]=o=>f.value=o),placeholder:"æœç´¢ä¹¦åæˆ–ä½œè€…ï¼ˆæŒ‰å›è½¦æŸ¥è¯¢ï¼‰",clearable:"",onClear:U,onKeyup:J(L,["enter"]),style:{width:"280px"}},null,8,["modelValue"])])]),H((p(),Q(T,{data:B.value,border:"",style:{width:"100%","border-radius":"12px","margin-top":"16px"},"empty-text":"æš‚æ— å›¾ä¹¦æ•°æ®"},{default:d(()=>[s(a,{prop:"id",label:"ID",width:"60",align:"center"}),s(a,{label:"å°é¢",width:"100",align:"center"},{default:d(({row:o})=>[o.cover_url?(p(),v("img",{key:0,src:D(o.cover_url),class:"book-cover",alt:"å°é¢"},null,8,oe)):(p(),v("span",ne,"æš‚æ— "))]),_:1}),s(a,{prop:"title",label:"ä¹¦å"}),s(a,{prop:"author",label:"ä½œè€…"}),s(a,{prop:"price",label:"ä»·æ ¼",width:"120",align:"center"},{default:d(({row:o})=>[u(i(S(o.price)),1)]),_:1}),s(a,{prop:"publish_date",label:"å‡ºç‰ˆæ—¥æœŸ",formatter:z,width:"140"}),s(a,{label:"åº“å­˜",width:"160",align:"center"},{default:d(({row:o})=>[l("div",se,[l("div",null,[l("strong",null,i(o.available_count??"â€”"),1),e[3]||(e[3]=u(" å¯å€Ÿ"))]),l("div",re,"æ€» "+i(o.total_count??"â€”"),1)])]),_:1}),s(a,{prop:"status",label:"çŠ¶æ€",width:"140",align:"center"},{default:d(({row:o})=>[s(b,{type:E(o),"disable-transitions":""},{default:d(()=>[u(i(x(o)),1)]),_:2},1032,["type"])]),_:1}),s(a,{label:"æ“ä½œ",width:"180",align:"center"},{default:d(({row:o})=>[s(F,{size:"small",type:"default",onClick:K=>M(o)},{default:d(()=>e[4]||(e[4]=[u(" æŸ¥çœ‹ ")])),_:2,__:[4]},1032,["onClick"]),s(F,{size:"small",type:"primary",onClick:K=>$(o),disabled:Number(o.available_count)<=0},{default:d(()=>[u(i(Number(o.available_count)>0?"å€Ÿé˜…":"å·²å€Ÿå®Œ"),1)]),_:2},1032,["onClick","disabled"])]),_:1})]),_:1},8,["data"])),[[I,y.value]]),l("div",ie,[s(W,{background:"",layout:"prev, pager, next, jumper, ->, total","current-page":g.value,"page-size":h.value,total:V.value,onCurrentChange:A,onSizeChange:j,"page-sizes":[5,10,20,50]},null,8,["current-page","page-size","total"])])]),s(q,{modelValue:k.value,"onUpdate:modelValue":e[1]||(e[1]=o=>k.value=o),title:"å›¾ä¹¦è¯¦æƒ…",size:"35%"},{default:d(()=>[w.value?(p(),v("div",ue,"åŠ è½½ä¸­...")):r.value?(p(),v("div",de,[r.value.cover_url?(p(),v("img",{key:0,src:D(r.value.cover_url),alt:"å°é¢",class:"detail-cover"},null,8,ce)):Y("",!0),l("div",pe,[l("p",null,[e[5]||(e[5]=l("strong",null,"ä¹¦åï¼š",-1)),u(i(r.value.title),1)]),l("p",null,[e[6]||(e[6]=l("strong",null,"ä½œè€…ï¼š",-1)),u(i(r.value.author||"æœªçŸ¥"),1)]),l("p",null,[e[7]||(e[7]=l("strong",null,"å‡ºç‰ˆç¤¾ï¼š",-1)),u(i(r.value.publisher||"â€”"),1)]),l("p",null,[e[8]||(e[8]=l("strong",null,"å‡ºç‰ˆæ—¥æœŸï¼š",-1)),u(i(z(null,null,r.value.publish_date)),1)]),l("p",null,[e[9]||(e[9]=l("strong",null,"ä»·æ ¼ï¼š",-1)),u(i(S(r.value.price)),1)]),l("p",null,[e[10]||(e[10]=l("strong",null,"åº“å­˜ï¼š",-1)),u(i(r.value.available_count)+" / "+i(r.value.total_count),1)]),l("p",null,[e[11]||(e[11]=l("strong",null,"çŠ¶æ€ï¼š",-1)),u(i(x(r.value)),1)])])])):(p(),v("div",ve,"æš‚æ— è¯¦æƒ…"))]),_:1},8,["modelValue"])],64)}}},fe=P(_e,[["__scopeId","data-v-03f578fb"]]);export{fe as default};
