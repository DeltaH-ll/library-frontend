import{_ as F,r as c,l as U,c as f,a as d,q as W,b as s,s as j,d as u,v as K,i as P,w as n,E as y,o as g,f as b,t as m,z as T,x as I}from"./index-CVtVCzsP.js";import{r as x,A as L}from"./request-CSTMYV-j.js";const R={class:"books-root"},G={class:"books-header"},H={class:"books-actions"},J=["src"],O={key:1,class:"no-cover"},Q={class:"pager",style:{display:"flex","justify-content":"flex-end","margin-top":"12px"}},X={__name:"MyBorrow",setup(Y){const w=c([]),p=c(""),h=c(!1),l=c(1),_=c(10),k=c(0),C=e=>{switch(e.status){case"å€Ÿå‡º":return"warning";case"å·²è¿˜":return"success";case"é€¾æœŸ":return"danger";default:return"info"}},B=e=>{const a=Number(e);return Number.isFinite(a)?`Â¥${a.toFixed(2)}`:"Â¥0.00"},z=e=>{if(!e)return"";if(e.startsWith("http://")||e.startsWith("https://"))return e;const a=L.replace(/\/$/,""),i=e.startsWith("/")?e:`/${e}`;return a+i},r=async()=>{h.value=!0;try{const a=(await x.get("/borrow",{params:{page:l.value,limit:_.value,q:p.value||void 0}})).data||{};w.value=a.data||[],k.value=a.total||0}catch(e){console.error(e),y.error("åŠ è½½å€Ÿé˜…è®°å½•å¤±è´¥")}finally{h.value=!1}},S=async e=>{var a,i;try{await I.confirm("ç¡®å®šè¦å½’è¿˜è¿™æœ¬ä¹¦å—ï¼Ÿ","å½’è¿˜ç¡®è®¤",{type:"warning"}),await x.put(`/borrow/${e}/return`),y.success("å½’è¿˜æˆåŠŸ"),r()}catch(o){if(o!=="cancel"){const v=((i=(a=o==null?void 0:o.response)==null?void 0:a.data)==null?void 0:i.error)||"å½’è¿˜å¤±è´¥";y.error(v)}}},E=()=>{l.value=1,r()},V=()=>{l.value=1,p.value="",r()},D=e=>{l.value=e,r()},M=e=>{_.value=e,l.value=1,r()};return U(r),(e,a)=>{const i=u("el-input"),o=u("el-table-column"),v=u("el-tag"),N=u("el-button"),$=u("el-table"),q=u("el-pagination"),A=K("loading");return g(),f("div",R,[d("div",G,[a[1]||(a[1]=d("h1",{class:"books-title"},"ðŸ“š æˆ‘çš„å€Ÿé˜…",-1)),d("div",H,[s(i,{modelValue:p.value,"onUpdate:modelValue":a[0]||(a[0]=t=>p.value=t),placeholder:"æœç´¢ä¹¦åï¼ˆæŒ‰å›žè½¦æŸ¥è¯¢ï¼‰",clearable:"",onClear:V,onKeyup:j(E,["enter"]),style:{width:"280px"}},null,8,["modelValue"])])]),W((g(),P($,{data:w.value,border:"",style:{width:"100%","border-radius":"12px","margin-top":"16px"},"empty-text":"æš‚æ— å€Ÿé˜…è®°å½•"},{default:n(()=>[s(o,{label:"åºå·",width:"80",align:"center"},{default:n(({$index:t})=>[b(m((l.value-1)*_.value+t+1),1)]),_:1}),s(o,{label:"å°é¢",width:"100",align:"center"},{default:n(({row:t})=>[t.cover_url?(g(),f("img",{key:0,src:z(t.cover_url),class:"book-cover",alt:"å°é¢"},null,8,J)):(g(),f("span",O,"æš‚æ— "))]),_:1}),s(o,{prop:"book_title",label:"ä¹¦å"}),s(o,{prop:"book_author",label:"ä½œè€…",width:"140"}),s(o,{label:"ä»·æ ¼",width:"120",align:"center"},{default:n(({row:t})=>[b(m(B(t.book_price)),1)]),_:1}),s(o,{prop:"borrow_date",label:"å€Ÿå‡ºæ—¶é—´",width:"180"}),s(o,{prop:"return_date",label:"è¿˜ä¹¦æ—¶é—´",width:"180"},{default:n(({row:t})=>[d("span",{style:T({color:t.return_date?new Date(t.return_date)<new Date?"red":"":"inherit"})},m(t.return_date||"æœªå½’è¿˜"),5)]),_:1}),s(o,{prop:"status",label:"çŠ¶æ€",width:"140",align:"center"},{default:n(({row:t})=>[s(v,{type:C(t),"disable-transitions":""},{default:n(()=>[b(m(t.status),1)]),_:2},1032,["type"])]),_:1}),s(o,{label:"æ“ä½œ",width:"120",align:"center"},{default:n(({row:t})=>[s(N,{size:"small",type:"primary",onClick:Z=>S(t.id),disabled:t.status!=="å€Ÿå‡º"},{default:n(()=>a[2]||(a[2]=[b(" å½’è¿˜ ")])),_:2,__:[2]},1032,["onClick","disabled"])]),_:1})]),_:1},8,["data"])),[[A,h.value]]),d("div",Q,[s(q,{background:"",layout:"prev, pager, next, jumper, ->, total","current-page":l.value,"page-size":_.value,total:k.value,onCurrentChange:D,onSizeChange:M,"page-sizes":[5,10,20,50]},null,8,["current-page","page-size","total"])])])}}},ae=F(X,[["__scopeId","data-v-0844e982"]]);export{ae as default};
